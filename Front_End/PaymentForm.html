<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">

</head>
<body style="width: 1524px">
<header>
    <!--  //logo-->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <!--      <a class="navbar-brand" href="#">-->
            <!--        <img src="../Assets/dKP.png" alt="Logo" width="30" height="24" class="d-inline-block align-text-top">-->
            <!--        Dkp-Product  </a>-->
        </div>
        <!--/links-->
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
                    aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>


            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <!--          <a href="../DashBord.html" class="nav-link active" aria-current="page" href="#">Home</a>-->
                    <a class="nav-link active" aria-current="page" href="#">Orders</a>
                    <a class="nav-link active" aria-current="page" href="#">Items</a>
                    <a class="nav-link active" aria-current="page" href="#">Customers</a>

                </div>
            </div>
            <!--  Search-->
        </div>

        <div class="container-fluid">
            <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </nav>
</header>
<main>
    <section>
        <h1 class="bg-success p-2 text-white bg-opacity-75">Payment Details</h1>
    </section>
    <br>
    <section>

        <form id="PaymentForm3" class="was-validated">

            <div class="row">

                <div class="col">
                    <div class="form-group">
                        <label>Orders :</label>
                        <select class="form-control" id="OrderId">
                        </select>
                        <span class="control-error"
                              id="OrderId-empty-error"></span>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Order Details :</label>
                        <select class="form-control" id="OrderDetailsId">
                        </select>
                        <span class="control-error"
                              id="OrderDetailsId-empty-error"></span>
                    </div>
                </div>

                <div class="col">
                    <div class="form-group">
                        <label>Order Details :</label>
                        <select class="form-control" id="OrderDetailsId2">
                        </select>
                        <span class="control-error"
                              id="OrderDetailsId2-empty-error"></span>
                    </div>
                </div>
            </div>

            <br>
            <div class="row">

                <div class="col">
                    <label for="txtOrderId">Order Id</label>
                    <input type="text" class="is-invalid form-control" id="txtOrderId" placeholder=""
                           name="orderId"
                           aria-label="OrderId" required>
                </div>
                <div class="col">
                    <label for="txtDate">Date</label>
                    <input type="text" class="is-invalid form-control" id="txtDate" placeholder=""
                           name="date"
                           aria-label="Date" required>
                </div>


                <div class="col">
                    <label for="txtCustomerId">CustomerId</label>
                    <input type="text" id="txtCustomerId" class="is-invalid form-control"
                           placeholder=""
                           name="customerId" aria-label="customerId" required>
                </div>

            </div>
        </form>


        <form id="PaymentForm2" class="was-validated">

            <div class="row">

                <div class="col">
                    <label for="txtCarId">Car_Id</label>
                    <input type="text" class="form-control is-invalid" id="txtCarId" placeholder=""
                           name="CarId"
                           aria-label="CarId" required>
                </div>
                <div class="col">
                    <label for="txtCarType">CarTye</label>
                    <input type="text" class="form-control is-invalid" id="txtCarType" placeholder=""
                           name="carType"
                           aria-label="carType" required>
                </div>
                <div class="col">
                    <label for="txtCarVersion">Version</label>
                    <input type="text" class="form-control is-invalid" id="txtCarVersion" placeholder=""
                           name="carVersion"
                           aria-label="CarVersion" required>
                </div>
                <div class="col">
                    <label for="txtNeed">Need Car</label>
                    <input type="text" class="form-control is-invalid" id="txtNeed" placeholder=""
                           name="need"
                           aria-label="Need" required>
                </div>
                <div class="col">
                    <label for="txtTotalMoney">TotalMoney</label>
                    <input type="text" id="txtTotalMoney" class="is-invalid form-control d-inline-block"
                           placeholder=""
                           name="totalMoney"
                           aria-label="TotalMoney" required>
                </div>

            </div>
            <br>
            <br>
            <br>
            <br>

        </form>

        <form id="PaymentForm" class="was-validated">

            <div class="row">

                <div class="col">
                    <label for="txtUser">P_Id</label>
                    <input type="text" class="form-control is-invalid" id="txtUser" placeholder=""
                           name="user"
                           aria-label="User" required>
                </div>


                <div class="col">
                    <label for="txtVersion">Rent_Free</label>
                    <input type="text" class="form-control is-invalid" id="txtVersion" placeholder=""
                           name="rentFree"
                           aria-label="RentFree" required>
                </div>
                <div class="col">
                    <label for="txtType">Driver_Free</label>
                    <input type="text" class="form-control is-invalid" id="txtType" placeholder=""
                           name="driverFree"
                           aria-label="DriverFree" required>
                </div>
                <div class="col">
                    <label for="txtFuel">Travel_Distance</label>
                    <input type="text" id="txtFuel" class="is-invalid form-control d-inline-block"
                           placeholder=""
                           name="travelDistance"
                           aria-label="TravelDistance" required>
                </div>

            </div>
            <br>
            <div class="row">

                <div class="col">
                    <label for="txtPassengers">Loss_Damage</label>
                    <input type="text" class="form-control is-invalid" id="txtPassengers" placeholder=""
                           name="lossDamage"
                           aria-label="LossDamage" required>
                </div>
                <div class="col">
                    <label for="txtTransmission">calc_LossDamage</label>
                    <input type="text" class="form-control is-invalid" id="txtTransmission" placeholder=""
                           name="calcLossDamage"
                           aria-label="calcLossDamage" required>
                </div>
                <div class="col">
                    <label for="txtColour">Payment_Date</label>
                    <input type="Date" id="txtColour" class="is-invalid form-control d-inline-block"
                           placeholder=""
                           name="paymentDate"
                           aria-label="PaymentDate" required>
                </div>

            </div>

            <br>
            <div class="row">

                <div class="col">
                    <label for="txtRent_duration">Extra_Km</label>
                    <input type="text" class="is-invalid form-control" id="txtRent_duration" placeholder=""
                           name="extraKm"
                           aria-label="ExtraKm" required>
                </div>
                <div class="col">
                    <label for="txtPrice">Extra_Km_Price</label>
                    <input type="text" id="txtPrice" class="is-invalid form-control"
                           placeholder=""
                           name="extraKmPrice" aria-label="ExtraKmPrice" required>
                </div>
                <div class="col">
                    <label for="txtPrice_ExtraKm">Full_Payment</label>
                    <input type="text" id="txtPrice_ExtraKm" class="is-invalid form-control"
                           placeholder=""
                           name="fullPayment" aria-label="FullPayment" required>
                </div>

            </div>
        </form>
        <br><br>
        <button type="button" id="SavePayment" class="btn btn-primary">Save</button>
        <!--        <button type="button" class="btn btn-secondary">Remove</button>-->
        <button type="button" id="BtnUpdate" class="btn btn-success">Update</button>
        <button type="button" id="BtnDelete" class="btn btn-danger">Delete</button>
        <button type="button" id="BtnClearAll" class="btn btn-warning">Clearall</button>
        <button type="button" id="btnLoadAll" class="btn btn-info">getall</button>


    </section>
    <br>
    <br>
    <section>
        <table style="width: 95%" border="2px solid red"
               class="col table table-bordered border-primary table-dark table-striped">
            <thead class="bg-danger text-white">
            <tr>
                <th>P_Id</th>
                <th>Rent_Free</th>
                <th>Driver_Free</th>
                <th>Travel_Distance</th>
                <th>Loss_Damage</th>
                <th>calc_LossDamage</th>
                <th>Payment_Date</th>
                <th>Extra_Km</th>
                <th>Extra_Km_Price</th>
                <th>Full_Payment</th>
            </tr>
            </thead>
            <tbody id="tblPayment">

            </tbody>
        </table>

    </section>
</main>

<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/jquery-3.6.1.min.js"></script>


<script>
    $("#BtnClearAll").click(function () {
        setTextFieldValues();
        // $("#txtCustomerNic").refresh();

    });

    let baseURL = "http://localhost:8080/Back_End_war/";

    getAll();
    getAllOrders();
    getAllOrdersDetails();
    $("#SavePayment").click(function () {

        var formData = $("#PaymentForm").serialize();
        console.log(formData);
        $.ajax({
            url: baseURL + "Payment",
            method: "post",
            data: formData,
            dataType: "json",
            success: function (res) {
                alert(res.message);
                getAll();
            },
            error: function (error) {
                var jsObject = JSON.parse(error.responseText);
                alert(jsObject.message);
            }
        });
    });

    $("#btnLoadAll").click(function () {
        getAll()
    });


    // update value
    $("#BtnUpdate").click(function () {

        let P_Id = $("#txtUser").val();
        let Rent_Free=$("#txtVersion").val();
        let Driver_Free=$("#txtType").val();
        let Travel_Distance=$("#txtFuel").val();
        let Loss_Damage=$("#txtPassengers").val();
        let calc_LossDamage=$("#txtTransmission").val();
        let Payment_Date=$("#txtColour").val();
        let Extra_Km=$("#txtRent_duration").val();
        let Extra_Km_Price=$("#txtPrice").val();
        let Full_Payment=$("#txtPrice_ExtraKm").val();





        var Payment = {
                user:P_Id,
                rentFree :Rent_Free,
                driverFree :Driver_Free,
                travelDistance :Travel_Distance,
                lossDamage :Loss_Damage,
                calcLossDamage:calc_LossDamage,
                paymentDate :Payment_Date,
                extraKm :Extra_Km,
                extraKmPrice: Extra_Km_Price,
                fullPayment :Full_Payment
        }

        $.ajax({
            url: baseURL+'Payment',
            method: 'put',
            contentType:"application/json",
            data:JSON.stringify(Payment),
            dataType:"json",
            success: function (res) {
                alert(res.message);
                getAll();
            },
            error:function (error){
                let cause= JSON.parse(error.responseText).message;
                alert(cause);
            }

        });
    });

    //Delete Value
    // $("#BtnDelete").click(function () {
    //
    //     let id = $("#txtCustomerID").val();
    //     $.ajax({
    //         url: baseURL+"Customer?id=" + id + "",
    //         method: "delete",
    //         dataType:"json",
    //         success: function (resp) {
    //             alert(resp.message);
    //             getAll();
    //         },
    //         error:function (error){
    //             alert(JSON.parse(error.responseText).message);
    //         }
    //     });
    // });


    function getAll() {
        $("#tblPayment").empty();

        $.ajax({
            url: baseURL + "Payment",
            dataType: "json",
            success: function (resp) {
                    console.log(resp);

                for (let cus of resp.data) {

                    var rows = '<tr><td>' + cus.user+
                        '</td><td>' + cus.rentFree +
                        '</td><td>' + cus.driverFree +
                        '</td><td>' + cus.travelDistance +
                        '</td><td>' + cus.lossDamage +
                        '</td><td>' + cus.calcLossDamage +
                        '</td><td>' + cus.paymentDate +
                        '</td><td>' + cus.extraKm +
                        '</td><td>' + cus.extraKmPrice +
                        '</td><td>' + cus.fullPayment +
                        '</td></tr>';
                    // console.log(row);
                 $("#tblPayment").append(rows);

                }
                EventBindingvalue();
                setTextFieldValues("", "", "", "", "", "", "","", "", "");
                $("#txtUser").focus();
            }
        });
    }


    function setTextFieldValues(user, rentFree, driverFree, travelDistance, lossDamage, calcLossDamage, paymentDate,extraKm,extraKmPrice,fullPayment) {
        $("#txtUser").val(user);
        $("#txtVersion").val(rentFree);
        $("#txtType").val(driverFree);
        $("#txtFuel").val(travelDistance);
        $("#txtPassengers").val(lossDamage);
        $("#txtTransmission").val(calcLossDamage);
        $("#txtColour").val(paymentDate);
        $("#txtRent_duration").val(extraKm);
        $("#txtPrice").val(extraKmPrice);
        $("#txtPrice_ExtraKm").val(fullPayment);

    }

    //  mehidi table eka click karama data print we
    function EventBindingvalue() {
        $("#tblPayment>tr").click(function () {

            let user = $(this).children(":eq(0)").text();
            let rentFree = $(this).children(":eq(1)").text();
            let driverFree = $(this).children(":eq(2)").text();
            let travelDistance = $(this).children(":eq(3)").text();
            let lossDamage = $(this).children(":eq(4)").text();
            let calcLossDamage = $(this).children(":eq(5)").text();
            let paymentDate = $(this).children(":eq(6)").text();
            let extraKm = $(this).children(":eq(7)").text();
            let extraKmPrice = $(this).children(":eq(8)").text();
            let fullPayment = $(this).children(":eq(9)").text();

            //  tble eke textfild walata data add karanawa
            $("#txtUser").val(user);
            $("#txtVersion").val(rentFree);
            $("#txtType").val(driverFree);
            $("#txtFuel").val(travelDistance);
            $("#txtPassengers").val(lossDamage);
            $("#txtTransmission").val(calcLossDamage);
            $("#txtColour").val(paymentDate);
            $("#txtRent_duration").val(extraKm);
            $("#txtPrice").val(extraKmPrice);
            $("#txtPrice_ExtraKm").val(fullPayment);

        });

        // //double click remove table colom
        // $("#tblCustomer>tr").on('dblclick', function () {
        //     $(this).remove();
        // });

    }

    // //Enter Button use for textfield
    // $("#txtCustomerID").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerName").focus();
    //     }
    //
    // });
    //
    // $("#txtCustomerName").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerContNo").focus();
    //     }
    //
    // });
    //
    // $("#txtCustomerContNo").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerAddress").focus();
    //     }
    //
    // });

    // $("#txtCustomerAddress").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         $("#txtCustomerSalary").focus();
    //     }
    //
    // });
    //
    // $("#txtCustomerSalary").on('keydown', function (event) {
    //
    //     if (event.key == "Enter") {
    //         confirm("Do You Want To Add This Customer...?")
    //         $("#SaveCustomer").focus();
    //     }
    //
    // });

    // Tap Button Remove
    // $("#txtCustomerID,#txtCustomerName,#txtCustomerCon,#txtCustomerAddress,#txtCustomerSalary").on('keydown', function (event) {
    //
    //     if (event.key == "Tab") {
    //         event.preventDefault();
    //     }
    // });


    function getAllOrders() {
        $("#OrderId").empty();
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            success: function (resp) {
                // console.log(resp);
                for (let cus of resp.data) {
                    // console.log(cus.orderId);
                    console.log(cus.oid);

                    $("#OrderId").append(`<option value="${cus.oid}">${cus.oid}</option>`);

                }
            }
        });
    }

    function searchOrders(OderId) {
        let response = "";
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            async: false,
            success: function (resp) {
                response = resp.data.filter((c) => {
                    return c.oid == OderId;
                });
            }
        });
        console.log(response);
        return response;
    }

    $("#OrderId").change(function () {
        let OderId = $("#OrderId").val();
        $("#OrderId").val(OderId);
        let res = searchOrders(OderId);
        if (res.length > 0) {

            $("#txtOrderId").val(res[0].oid);
            $("#txtDate").val(res[0].date);
            $("#txtCustomerId").val(res[0].cusID);


        }

    });




    function getAllOrdersDetails() {
        $("#OrderDetailsId").empty();
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            success: function (resp) {
                console.log(resp);
                for (let cus of resp.data) {

                    $("#OrderDetailsId").append(`<option value="${cus.scheduleId}">${cus.scheduleId}</option>`);

                }
            }
        });
    }

    function searchOrdersDetails(ScheduleIds) {
        let response = "";
        $.ajax({
            url: baseURL + "purchase",
            dataType: "json",
            async: false,
            success: function (resp) {
                response = resp.data.filter((c) => {
                    return c.scheduleId == ScheduleIds;
                });
            }
        });
        console.log(response);
        return response;
    }

    $("#OrderDetailsId").change(function () {
        let ScheduleIds = $("#OrderDetailsId").val();
        $("#OrderDetailsId").val(ScheduleIds);
        let res = searchOrdersDetails(ScheduleIds);
        if (res.length > 0) {

            // $("#txtOrderId").val(res[0].orderId);
            // $("#txtDate").val(res[0].date);
            // $("#txtCustomerId").val(res[0].customerId);


        }

    });
</script>
</body>
</html>